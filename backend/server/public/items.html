<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="fontawesome/css/all.css">
    <link rel="stylesheet" href="jquery-ui-1.13.3/jquery-ui.css">
    <script src="jquery/jquery-3.7.1.min.js"></script>
    <script src="jquery-ui-1.13.3/jquery-ui.js"></script>
    <script src="jquery-validation-1.19.5/jquery.validate.min.js"></script>
    <title>Debtors Acoounting</title>
    <style>
 /* Add some padding and rounded corners to the dialog box */
 
  #snackbar {
    visibility: hidden;
    min-width: 250px;
    margin-left: -125px;
    background-color: #4CAF50;
    color: #fff;
    text-align: center;
    border-radius: 5px;
    padding: 16px;
    position: fixed;
    z-index: 1;
    left: 50%;
    bottom: 30px;
    font-size: 17px;
  }

  #snackbar.show {
    visibility: visible;
    -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
  }

  @keyframes fadein {
    from {bottom: 0; opacity: 0;} 
    to {bottom: 30px; opacity: 1;}
  }

  @keyframes fadeout {
    from {bottom: 30px; opacity: 1;} 
    to {bottom: 0; opacity: 0;}
  }

#thinking {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    font-family: 'Roboto', sans-serif; /* Use a clean and modern font */
}

/* Style form labels */
#thinking label {
    font-size: 14px;
    font-weight: bold;
    margin-top: 10px;
    color: #333;
}

/* Add more space between form fields */
#thinking input {
    width: 50%;
    padding: 8px;
    margin-top: 5px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 14px;
    box-sizing: border-box;
}

/* Focus state for input fields */
#thinking input:focus {
    border-color: #007bff;
    outline: none;
}
.containerList {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 50px;
}

.list {
    border: 2px solid #ccc; /* Added border */
    padding: 5px;
    width: 200px;
    min-height: 200px;
    border-radius: 5px; /* Optional: adds rounded corners */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Optional: adds shadow */
}

.list li {
    list-style: none;
    padding: 10px;
    cursor: pointer;
    margin: 5px 0;
    text-align: center;
}

.list li:hover, .ui-selected {
    background-color: orange;
    color: white;
}


/* Improve button style */
#thinking button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#thinking button:hover {
    background-color: #0056b3;
}

/* Style for the lists in the dialog box */
#subjects, #selectedsubjects {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 200px;
    overflow-y: auto;
}

#subjects li, #selectedsubjects li {
    padding: 10px;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

#subjects li:hover, #selectedsubjects li:hover, .ui-selected {
    background-color: #28a745;
    color: white;
}

/* Add some space around the container holding the lists */
.containerList {
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 10px;
}

/* Style for buttons to move items */
.buttons button {
    background-color: #17a2b8;
    color: white;
    padding: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
    cursor: pointer;
}

.buttons button:hover {
    background-color: #117a8b;
}


    </style>
<script>
          $(document).ready(function(){
            $("#subjects, #selectedsubjects").sortable({
                connectWith: ".list",
                dropOnEmpty: true
            }).disableSelection();

            $("#moveRight").click(function(){
                $("#subjects li.ui-selected").appendTo("#selectedsubjects");
            });
            
            $("#moveLeft").click(function(){
                $("#selectedsubjects li.ui-selected").appendTo("#subjects");
            });
            
            $("ul.list").on("click", "li", function(){
                $(this).toggleClass("ui-selected");
            });
        });

  // Initialize on document ready
  // Function to add the selected item

// When the dialog is opened, ensure the lists are reset
const justDoIt = () => {
  $("#thinking").dialog({
    "show": { effect: "drop", direction: "left", duration: 2000 },
    "title": "Notification",
    "width": 500,
    "height": 500,
    "resizable": false,
    "draggable": false,
    "modal": true,
    buttons: [
      {
        text: "Add",
        icon: "ui-icon-extlink",
        click: addItem
      },
      {
        text: "cancel",
        click: function () {
          $(this).dialog("close");
        }
      }
    ]
  });
};

// Load the items when the page is ready
const loadItems = () => {
  const tbody = $("#itemsView>tbody");
  tbody.html('<tr><td colspan="3" align="center"><i class="fa-solid fa-spinner fa-spin"></i></td></tr>');
  getItems().then(items => {
    tbody.html("");
    if (items.length === 0) {
      tbody.append('<tr><td colspan="6" align="center"><b>No items available</b></td></tr>');
      return;
    }
    items.forEach((item, index) => {
      tbody.append(
        `<tr id="${item.code}">
          <td>${index + 1}</td>
          <td>${item.code}</td>
          <td>${item.name}</td>
        </tr>`
      );
    });
    // Add click event for item rows
    tbody.find("tr").on("click", function () {
      const itemId = $(this).attr("id");
      const selectedItem = items.find(item => item.code == itemId);
      loadItemsDetails(selectedItem);
    });
  })
  .catch(error => {
    tbody.html(`<tr><td colspan="6" align="center">${error}</td></tr>`);
  });
};

// Fetch items from the server
const getItems = () => {
  return new Promise((resolve, reject) => {
    fetch('/getItems')
      .then(response => {
        if (!response.ok) throw Error("Can not fetch api");
        return response.json();
      })
      .then(items => {
        resolve(items);
      })
      .catch(error => {
        reject(error.message);
      });
  });
};

// Fetch item details from the server
const getItemsDetails = (item) => {
  return new Promise((resolve, reject) => {
    fetch('/getItemsDetails')
      .then(response => {
        if (!response.ok) throw Error("Can not fetch api");
        return response.json();
      })
      .then(itemDetails => {
        resolve(itemDetails);
      })
      .catch(error => {
        reject(error.message);
      });
  });
};

// Load the item details when clicked
const loadItemsDetails = (item) => {
  const k = $("#itemDetailDivision");
  k.html("");
  k.append($("<p style='color:black;font-size: 12pt;'>Detail</p>"));
  k.append($("<p align='center'><i class='fa-solid fa-spinner fa-spin'></i></p>"));
  getItemsDetails(item).then((itemDetail) => {
    k.html("");
    k.html(`
      <div class='x_panel'>
        <table>
          <br>
          <tr>
            <th style='font-size: 16pt;'>Item Tax</th>
          </tr>
          <tr>
            <th style='font-size: 12pt;'>Item Name: ${item.name}</th>
          </tr>
          <tr>
            <th style='font-size: 12pt;'>CGST: ${item.cgst}</th>
          </tr>
          <tr>
            <th style='font-size: 12pt;'>SGST: ${item.sgst}</th>
          </tr>
          <tr>
            <th style='font-size: 12pt;'>IGST: ${item.igst}</th>
          </tr>
        </table>
      </div>
    `);
  });
};


  
  $(() => {
  loadItems();
});

const addItem = () => {
  if ($("#formValid").valid()) {
    const formData = {
      code: $("#code").val(),
      name: $("#name").val(),
      sgst: $("#sgst").val(),
      cgst: $("#cgst").val(),
      igst: $("#igst").val(),
      selectedUnits: []  
    };

    // Collect selected units
    $("#selectedsubjects li").each(function () {
      formData.selectedUnits.push($(this).text()); 
    });

    // Send POST request
    fetch('/addItem', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
      .then(response => response.json())
      .then(data => {
        showSnackbar(data.message); // Snackbar function call
        $("#thinking").dialog("close");
        loadItems(); 
      })
      .catch(error => {
        alert("Error: " + error.message);
      });
  }
}
// Snackbar function
const showSnackbar = (message) => {
  const snackbar = $("#snackbar");
  snackbar.text(message);
  snackbar.addClass("show");
  setTimeout(() => snackbar.removeClass("show"), 3000);
};

//Form Validation
$(() =>{
      // Validate the form inside the dialog
      $("#formValid").validate({
          rules: {
              name: "required",
              sgst: {
                  required: true,
                  number: true
              },
              cgst: {
                  required: true,
                  number: true
              },
              igst: {
                  required: true,
                  number: true
              }
          },
          messages: {
              name: "Name is required",
              sgst: {
                  required: "SGST is required",
                  number: "Please enter a valid number"
              },
              cgst: {
                  required: "CGST is required",
                  number: "Please enter a valid number"
              },
              igst: {
                  required: "IGST is required",
                  number: "Please enter a valid number"
              }
          },
          errorPlacement: function (error, element) 
          {
            if (element.prop("id") === "name" || element.prop("id") === "sgst" || element.prop("id") === "cgst" || element.prop("id") === "igst") {
                        const errorContainer = $("#nameError");
                        errorContainer.html("");
                        error.appendTo(errorContainer);
                    } else {
                        error.insertAfter(element);
                    }    
          },
          success: function (label) {
              label.remove();
          }
      })
    });
//Dialog

</script>    




    <!-- Bootstrap -->
    <link href="vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
 
    <!-- Font Awesome -->
    <link href="vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="vendors/iCheck/skins/flat/green.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="build/css/custom.min.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index.html" class="site_title"><i class="fa fa-paw"></i> <span>Gentelella Alela!</span></a>
            </div>

            
            <!-- menu profile quick info -->
            <div class="profile clearfix ">
              <div class="profile_pic">
                <img src="images/img.jpg" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h2>John Doe</h2>
              </div>
            </div>
            <!-- /menu profile quick info -->

            <br />

            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>General</h3>
                <ul class="nav side-menu">
                  <li><a><i class="fa fa-home"></i> Home</a>
                  </li>
                   <li><a><i class="fa fa-table"></i> Tables </a>
                  </li>
                </ul>
              </div>
              <div  class="menu_section">
                <h3>Live On</h3>
                <ul class="nav side-menu">
                  <li><a><i class="fa fa-sitemap"></i> Multilevel Menu <span class="fa fa-chevron-down"></span></a>        
                  </li>                  
                  <li><a href="javascript:void(0)"><i class="fa fa-laptop"></i> Landing Page <span class="label label-success pull-right">Coming Soon</span></a></li>
                </ul>
              </div>

            </div>
            <!-- /sidebar menu -->

            <!-- /menu footer buttons -->
            <div class="sidebar-footer hidden-small">
              <a data-toggle="tooltip" data-placement="top" title="Settings">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Lock">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Logout" href="login.html">
                <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
              </a>
            </div>
            <!-- /menu footer buttons -->
          </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
            <div class="nav_menu">
                <div class="nav toggle">
                  <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                </div>
                <nav class="nav navbar-nav">
                <ul class=" navbar-right">
                  <li class="nav-item dropdown open" style="padding-left: 15px;">
                    <a href="javascript:;" class="user-profile dropdown-toggle" aria-haspopup="true" id="navbarDropdown" data-toggle="dropdown" aria-expanded="false">
                      <img src="images/img.jpg" alt="">John Doe
                    </a>
                    <div class="dropdown-menu dropdown-usermenu pull-right" aria-labelledby="navbarDropdown">
                      <a class="dropdown-item"  href="javascript:;"> Profile</a>
                        <a class="dropdown-item"  href="javascript:;">
                          <span class="badge bg-red pull-right">50%</span>
                          <span >Settings</span>
                        </a>
                    <a class="dropdown-item"  href="javascript:;">Help</a>
                      <a class="dropdown-item"  href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a>
                    </div>
                  </li>
  
                  <li role="presentation" class="nav-item dropdown open">
                    <a href="javascript:;" class="dropdown-toggle info-number" id="navbarDropdown1" data-toggle="dropdown" aria-expanded="false">
                      <i class="fa fa-envelope-o"></i>
                      <span class="badge bg-green">6</span>
                    </a>
                    <ul class="dropdown-menu list-unstyled msg_list" role="menu" aria-labelledby="navbarDropdown1">
                      <li class="nav-item">
                        <a class="dropdown-item">
                          <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                          <span>
                            <span>John Smith</span>
                            <span class="time">3 mins ago</span>
                          </span>
                        </a>
                      </li>
                      
                    </ul>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col"  role="main" >
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Users <small>Debtors Accounting</small></h3>
              </div>

              <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search for...">
                    <span class="input-group-btn">
                      <button class="btn btn-secondary" type="button">Go!</button>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-12 col-sm-12 ">
            <div class="x_panel">
              <div class="x_title" id="aksh">
                <h2>Debtors </h2>
                <ul class="nav navbar-right panel_toolbox">
                  <li><a class="add-link"><i class="fa fa-plus" onclick="justDoIt()" ></i></a></li>
                  <li><a class="close-link"><i class="fa fa-close"></i></a>
                  </li>
                  <li><a><i class="fa fa-plus" ></i></a>
                  </li>
                </ul>
                
                
                <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="card-box table-responsive">
                      <table id="itemsView" class="table table-striped table-bordered" style="width:100%">
                        <thead>
                          <th>S.no</th>
                          <th>ac_code</th>
                          <th>ac_name</th>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Add Dialog box-->
          
          <div id="thinking" style="display: none;">
            <span id="nameError" style="color: red;"></span>
              <form id="formValid">
                <label for="code">name</label>
                <input type="text" id="code">
                <br/>
                <label for="sgst">SGST:</label>
                <input type="text" id="sgst" name="sgst"  >
                <br/>
                <label for="cgst">CGST:</label>
                <input type="text" id="cgst" name="cgst" >
                <br/>
                <label for="igst">IGST:</label>
                <input type="text" id="igst" name="igst" >
                <hr/>
                <div class="containerList">
                  <ul id="subjects" class="list">
                      <li id="1">Cm</li>
                      <li id="2">Galon</li>
                      <li id="3">Grams</li>
                      <li id="4">Kg</li>
                      <li id="5">Pcs</li>
                      <li id="5">Pouns</li>
                  </ul>
                  
                  <div class="buttons">
                      <button id="moveRight">&gt;</button>
                      <button id="moveLeft">&lt;</button>
                  </div>
                  
                  <ul id="selectedsubjects" class="list"></ul>
              </div>
                
              </form>
              
          </div>
  
        <!--End dialog box-->
          <!--Detail Section start-->
          <div  id="itemDetailDivision">
            <div >
              <div class="x_title">
                <h2></h2>
                
              <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="card-box table-responsive">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        

          
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            Gentelella - Bootstrap Admin Template by <a href="https://colorlib.com">Colorlib</a>
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>
    <div id="snackbar">Item added successfully!</div>

    <!-- jQuery -->
    
    <!-- Bootstrap -->
   <script src="vendors/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FastClick -->
    <script src="vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="vendors/nprogress/nprogress.js"></script>
    <!-- iCheck -->
    <script src="vendors/iCheck/icheck.min.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="build/js/custom.min.js"></script>
    
  </body>
</html>